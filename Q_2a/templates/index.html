{% extends "base.html" %}

{% block content %}
<!-- Heading -->
<h3 class="mt-3 text-white p-2 text-center" style="background-color:#1b7a43;">BOOK TITLES</h3>

<!-- Search and count row -->
<div class="d-flex justify-content-between align-items-center my-3 p-2" style="background-color:#cde5cf;">
  <div>
    <strong>Number of titles:</strong> {{ total }}
  </div>

  <form method="POST" class="d-flex align-items-center">
    <label for="category" class="me-2 fw-bold">Category:</label>
    <select name="category" id="category" class="form-select me-2" style="width:auto;">
      <option value="All" {% if category == 'All' %}selected{% endif %}>All</option>
      <option value="Children" {% if category == 'Children' %}selected{% endif %}>Children</option>
      <option value="Teens" {% if category == 'Teens' %}selected{% endif %}>Teens</option>
      <option value="Adult" {% if category == 'Adult' %}selected{% endif %}>Adult</option>
    </select>
    <button type="submit" class="btn btn-success">Search</button>
  </form>
</div>

<!-- Book list -->
{% for b in books %}
<div class="card mb-4 shadow-sm border-success">
  <div class="row g-0">
    <!-- Book cover -->
    <div class="col-md-2 d-flex align-items-center justify-content-center">
      <img src="{{ b['url'] }}" class="img-fluid rounded-start p-2" alt="{{ b['title'] }}">
    </div>

    <!-- Book info -->
    <div class="col-md-10">
      <div class="card-body">
        <h5 class="card-title text-success">{{ b['title'] }}</h5>
        <p class="mb-1"><strong>Author(s):</strong> {{ b['authors'] | join(', ') }}</p>
        <p class="mb-1"><strong>Category:</strong> {{ b['category'] }} &nbsp; | &nbsp;
          <strong>Pages:</strong> {{ b['pages'] }}</p>
        <p class="mb-1"><strong>Copies:</strong> {{ b['copies'] }} &nbsp; | &nbsp;
          <strong>Available:</strong> {{ b['available'] }}</p>

        <!-- Show first and last paragraph of description -->
        <div class="mt-2">
          <p>{{ b['description'][0] }}</p>
          {% if b['description']|length > 1 %}
          <p>{{ b['description'][-1] }}</p>
          {% endif %}
        </div>

        <!-- More details button -->
        <a href="{{ url_for('book_detail', title=b['title']) }}" class="btn btn-success mt-2">
          More details
        </a>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<!-- If no books found -->
{% if books|length == 0 %}
  <p class="text-center text-danger mt-4">No books found for this category.</p>
{% endif %}
{% endblock %}
